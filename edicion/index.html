<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fuenteovejuna - Edici√≥n Digital</title>
    
    <!-- CSS -->
    <link rel="stylesheet" href="../assets/css/main.css">
    <link rel="stylesheet" href="../assets/css/components.css">
    <link rel="stylesheet" href="../assets/css/edicion.css">
    
    <!-- Librer√≠a Supabase (CDN) - DEBE IR ANTES DE TUS SCRIPTS -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    
    <!-- Navegaci√≥n superior -->
    <nav class="top-nav" role="navigation" aria-label="Navegaci√≥n principal">
        <a href="../index.html" class="nav-back">‚Üê Inicio</a>
        <a href="../editor-social/index.html">Editor Social</a>
        <button id="btn-modo-usuario" class="btn-modo-usuario">üë§ Mi participaci√≥n</button>
    </nav>
    
    <!-- Layout principal -->
    <div class="main-layout">
        <!-- Columna principal para el texto TEI -->
        <div id="TEI" class="text-column"></div>

        <!-- Columna para las opciones y notas -->
        <div id="col-opciones" class="notes-column">
            <div id="resize-handle"></div>
            
            <!-- Barra de botones -->
            <div class="button-bar">
                <button class="tab-button active" data-tab="notas">Notas</button>
                <button class="tab-button" data-tab="opciones">Opciones</button>
                <button class="tab-button" data-tab="info">Acerca de</button>
            </div>
            
            <!-- Contenido de las pesta√±as -->
            <div class="tab-content active" id="tab-notas">
                <div id="panelNotas">
                    <div id="noteContent">
                        <p class="placeholder-text">Haz clic en el texto subrayado para ver las notas.</p>
                    </div>
                </div>
            </div>
            
            <div class="tab-content" id="tab-opciones">
                <div class="opciones-panel">
                    <h4>Lectura</h4>
                    
                    <div class="option-group">
                        <label class="option-item">
                            <span>Mostrar marcas de notas</span>
                            <label class="toggle-switch">
                                <input type="checkbox" id="toggle-notes" checked>
                                <span class="slider"></span>
                            </label>
                        </label>
                        
                        <label class="option-item">
                            <span>Mostrar separaci√≥n de estrofas</span>
                            <label class="toggle-switch">
                                <input type="checkbox" id="toggle-stanzas">
                                <span class="slider"></span>
                            </label>
                        </label>
                    </div>
                    
                    <h4>Tama√±o del texto</h4>
                    <div class="option-group">
                        <div class="font-size-controls">
                            <button id="decrease-font" class="font-btn">A-</button>
                            <span id="font-size-display">100%</span>
                            <button id="increase-font" class="font-btn">A+</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="tab-content" id="tab-info">
                <div class="info-panel">
                    <h4>Sobre la edici√≥n</h4>
                    <p style="line-height: 1.6; color: #555;">
                        Esta es una edici√≥n digital divulgativa de <em>Fuenteovejuna</em> 
                        con notas explicativas que puedes evaluar para ayudar a mejorarlas.
                    </p>
                    <p style="margin-top: 16px; line-height: 1.6; color: #555;">
                        Haz clic en las notas del panel y eval√∫alas con üëç (√∫til) o üëé (mejorable).
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal container (necesario para modal-modo.js) -->
    <div id="modal-container"></div>

    <!-- SCRIPTS EN ORDEN CORRECTO -->
    
    <!-- 1. Configuraci√≥n (credenciales Supabase) -->
    <script src="../assets/js/config.js"></script>
    
    <!-- 2. Cliente Supabase (usa config.js) -->
    <script src="../assets/js/supabase-client.js"></script>
    
    <!-- 3. Utilidades generales -->
    <script src="../assets/js/utils.js"></script>
    
    <!-- 4. Gesti√≥n de usuario -->
    <script src="../assets/js/user-manager.js"></script>
    
    <!-- 5. Modal de modo de participaci√≥n -->
    <script src="../assets/js/modal-modo.js"></script>
    
    <!-- 6. Gesti√≥n de notas (carga desde Supabase) -->
    <script src="../assets/js/notas.js"></script>
    
    <!-- 7. CETEIcean (tu versi√≥n custom) -->
    <script src="../assets/js/CETEI.js"></script>
    
    <!-- 8. Script inline: Cargar XMLs -->
    <script>
        // Variable global para almacenar las notas XML
        window.notasXML = null;

        // Cargar el archivo de notas externas
        fetch('../assets/xml/notas.xml')
            .then(response => response.text())
            .then(str => {
                const parser = new DOMParser();
                window.notasXML = parser.parseFromString(str, "application/xml");
                console.log('‚úì Notas XML cargadas:', window.notasXML);
            })
            .catch(error => console.error('Error cargando notas.xml:', error));

        // Cargar el documento TEI principal
        var CETEIcean = new CETEI();
        CETEIcean.getHTML5("../assets/xml/fuenteovejuna.xml", function(data) {
            document.getElementById("TEI").appendChild(data);
            console.log('‚úì TEI principal cargado');
        });
    </script>
    
    <!-- 9. Utilidades de renderizaci√≥n compartidas -->
    <script src="../assets/js/rendering-utils.js"></script>
    
    <!-- 10. L√≥gica de tu edici√≥n (procesa notas, eventos, etc.) -->
    <script src="../assets/js/edicion.js"></script>
    
    <!-- 11. Sistema de evaluaci√≥n (a√±ade botones üëçüëé) -->
    <script src="../assets/js/edicion-evaluacion.js"></script>

</body>
</html>
